<app-navbar></app-navbar>

<div class="card m-5">

  <p-toolbar styleClass="mb-4 gap-2">
    <ng-template pTemplate="left">
        <button pButton pRipple label="Ajouter" icon="pi pi-plus" class="p-button-success mr-2" (click)="showDialogAdd()"></button>
    </ng-template>

    <ng-template pTemplate="center">
      <span class="text-primary font-semibold text-xl">Liste Utilisateurs</span>
    </ng-template>

    <ng-template pTemplate="right">
        <button pButton pRipple label="Trier" icon="pi pi-search" class="p-button-help" (click)="showDialogTri()"></button>
    </ng-template>
  </p-toolbar>

  <p-table [value]="users" [scrollable]="true" scrollHeight="580px" [tableStyle]="{'min-width': '40rem'}">
      <ng-template pTemplate="header">
          <tr>
              <th>Nom</th>
              <th>Prenom</th>
              <th>Email</th>
              <th>Role</th>
              <th></th>
          </tr>
      </ng-template>
      <ng-template pTemplate="body" let-user>
        <div *ngIf="this.user.email != this.loggedUser.email; then other else own"></div>
        <ng-template #other>
          <tr>
            <td>{{user.nom}}</td>
            <td>{{user.prenom}}</td>
            <td>{{user.email}}</td>
            <td>{{user.role}}</td>
            <td>
              <button pButton pRipple type="button" [icon]="'pi pi-trash'" class="p-button-sm p-button-text p-button-danger"></button>
            </td>
          </tr>
        </ng-template>
        <ng-template #own>
          <tr>
            <td class="text-primary font-semibold">
              {{user.nom}}
              <span class="pi pi-user ml-2" style="color: rgb(23, 212, 23)"></span></td>
            <td class="text-primary font-semibold">{{user.prenom}}</td>
            <td class="text-primary font-semibold">{{user.email}}</td>
            <td class="text-primary font-semibold">{{user.role}}</td>
            <td>
              <button pButton pRipple type="button" [icon]="'pi pi-trash'" class="p-button-sm p-button-text p-button-danger"></button>
            </td>
          </tr>
        </ng-template>
      </ng-template>
        <ng-template pTemplate="summary">
          <div class="flex align-items-center justify-content-between">
            {{users ? users.length : 0 }} Utilisateur(s).
          </div>
      </ng-template>
  </p-table>
</div>

<!-- Formulaire pour ajouter un utilisateur-->

<p-dialog header="Header" [(visible)]="visibleDiagAdd" [modal]="true" [style]="{ top:'10%' }" [breakpoints]="{ '960px': '75vw', '740px': '100vw' }"
[draggable]="false" [focusOnShow]="true" [dismissableMask]="true" position="top">

  <ng-template pTemplate="header"><span class="font-bold">Ajout Utilisateur</span></ng-template>

  <form [formGroup]="addUserForm" >

    <div class="p-inputgroup mb-2">
      <span class="p-inputgroup-addon"><i class="pi pi-user"></i></span>
      <input type="text" pInputText placeholder="Nom" formControlName="nom">
    </div>

    <div class="p-inputgroup mb-2">
      <span class="p-inputgroup-addon"><i class="pi pi-user"></i></span>
      <input type="text" pInputText placeholder="Prenom" formControlName="prenom">
    </div>

    <div class="p-inputgroup mb-3">
      <span class="p-inputgroup-addon"><i class="pi pi-at"></i></span>
      <input type="text" pInputText placeholder="Email" formControlName="email">
    </div>

    <div class=" mb-2">
      <span class="font-semibold">Role :</span>
      <p-listbox [options]="roles" [style]="{'width':'20rem'}" [multiple]="true" [metaKeySelection]="false" [listStyle]="{'max-height': '220px'}" formControlName="role"></p-listbox>
    </div>

  </form>

  <ng-template pTemplate="footer">
    <p-progressSpinner *ngIf="this.loading==true" [style]="{width: '40px', height: '40px'}" styleClass="custom-spinner mr-3" strokeWidth="8" fill="var(--surface-ground)" animationDuration=".5s"></p-progressSpinner>
    <p-button
        [disabled]="this.loading"
        label="Ajouter"
        styleClass="p-button-rounded p-button-success"
        (click)="ajoutUser()"
    ></p-button>
    </ng-template>

</p-dialog>

<!-- Formulaire pour le tri-->

<p-dialog [(visible)]="visibleDiagTri" [modal]="true" [style]="{ top:'10%' }" [breakpoints]="{ '960px': '75vw', '740px': '100vw' }"
[draggable]="false" [focusOnShow]="true" [dismissableMask]="true" position="top">


  <form [formGroup]="formTri" >

    <div class="card flex justify-content-center ml-3 mr-3">
      <div class="flex flex-column gap-3">
          <div *ngFor="let category of categories" class="field-checkbox">
              <p-radioButton [inputId]="category.key" [value]="category.key" formControlName="tri"></p-radioButton>
              <label [for]="category.key" class="ml-2">{{ category.name }}</label>
          </div>
      </div>
    </div>

  </form>

  <ng-template pTemplate="footer">
    <p-button
        [rounded]="true"
        icon="pi pi-search"
        styleClass="p-button-rounded p-button-success p-3 p-button-help"
        (click)="trier()"
    ></p-button>
    </ng-template>

</p-dialog>
<p-toast position="bottom-center"></p-toast>
